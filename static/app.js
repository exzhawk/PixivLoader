// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var $big, $thumbnail, change_to, current_page, init, load_page;
    init = true;
    $big = $('#big');
    $thumbnail = $('#thumbnail');
    $thumbnail.owlCarousel({
      items: 5,
      margin: 10,
      center: true,
      nav: false,
      dots: false
    }).on('mousewheel', function(e) {
      if (e.deltaY < 0) {
        $thumbnail.trigger('next.owl');
      } else {
        $thumbnail.trigger('prev.owl');
      }
      return e.preventDefault();
    }).on('click', '.owl-item', function(e) {
      e.preventDefault();
      return $thumbnail.trigger('to.owl.carousel', [$(this).index(), 250, true]);
    }).on('changed.owl.carousel', function(e) {
      var count, current;
      current = e.item.index;
      change_to(current);
      count = e.item.count;
      if (count - current === 1) {
        return load_page(current_page);
      }
    });
    change_to = function(index) {
      var img_src;
      img_src = $thumbnail.find('.owl-stage').children('.owl-item').eq(index).find('.thumbnail_img').attr('big');
      return $big.css("background-image", "url('/get_file/" + img_src + "')");
    };
    $('#nextBtn').on("click", function() {
      return $thumbnail.trigger("next.owl");
    });
    $('#prevBtn').on("click", function() {
      return $thumbnail.trigger("prev.owl");
    });
    load_page = function(page_number) {
      $.getJSON({
        url: '/get_following/' + page_number,
        success: function(data) {
          var $item, i, illust, len;
          for (i = 0, len = data.length; i < len; i++) {
            illust = data[i];
            if (illust['special'] !== 'ugoku') {
              $item = $('<div>').addClass('owl-item');
              $('<div>').addClass('thumbnail_img').attr('big', illust['img'][0]).css("background-image", "url('/get_file/" + illust['thumbnail'] + "')").appendTo($item);
              $thumbnail.trigger("add.owl.carousel", [$item]);
            }
          }
          $thumbnail.trigger("refresh.owl.carousel");
          console.log(init);
          if (init === true) {
            change_to(0);
            return init = false;
          }
        }
      });
      return current_page += 1;
    };
    current_page = 1;
    return load_page(current_page);
  });

}).call(this);

//# sourceMappingURL=app.js.map
